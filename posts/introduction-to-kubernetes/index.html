<!DOCTYPE html><html lang="en"><head prefix="og: http://ogp.me/ns#"><title>Introduction to Kubernetes</title><link rel="stylesheet" href="/static/css/main.css"><link rel="stylesheet" href="/static/css/pygment.css"><link rel="stylesheet" href="/static/css/font-awesome.min.css"><link href="//fonts.googleapis.com/css?family=Droid+Sans:400,700" rel="stylesheet" type="text/css"><link rel="stylesheet" href="/static/vendor/lightbox2/css/lightbox.min.css"><link href="https://afeld.github.io/emoji-css/emoji.css" rel="stylesheet"><link rel="shortcut icon" type="image/png" href="/static/images/favicon.png"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="<p>What is Kubernetes? What does it consist of? A practical example</p>"><meta name="author" content="Jahongir Rahmonov"><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"><meta property="og:title" content="Introduction to Kubernetes"><meta property="og:type" content="website"><meta property="og:image" content="/static/images/programming.jpg"><meta property="og:url" content="http://rahmonov.me/posts/introduction-to-kubernetes/"><meta property="og:description" content="<p>What is Kubernetes? What does it consist of? A practical example</p>"><link href="http://rahmonov.me/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="Jahongir Rahmonov Full Atom Feed"><link href="http://rahmonov.me/feeds/rss.xml" type="application/rss+xml" rel="alternate" title="Jahongir Rahmonov Full RSS Feed"><link href="http://rahmonov.me/feeds/programming.atom.xml" type="application/atom+xml" rel="alternate" title="Jahongir Rahmonov Categories Atom Feed"><meta name="description" content="<p>What is Kubernetes? What does it consist of? A practical example</p>"><meta name="tags" content="kubernetes"><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-7110437178205620",
            enable_page_level_ads: true
       });
  </script><link href="https://unpkg.com/ilyabirman-likely@2/release/likely.css" rel="stylesheet"><script src="https://unpkg.com/ilyabirman-likely@2/release/likely.js" type="text/javascript"></script></head><body id="index" class="home"><div class="container"><button class="nav js-mobile"><i class="fa fa-bars"></i></button><div class="side"><div class="logo"><a href="/"><img src="/static/images/me.jpg" width="150px" height="150px" class="jahon" alt="Jahongir Rahmonov"></a></div><h2>Jahongir Rahmonov</h2><div class="paragraphs"><p> I'm a Software Developer at <a href="http://mysuperdispatch.com/">Super Dispatch (TechStars '16)</a>. Avid reader. <a href="http://wiut.uz/">WIUT</a> graduate. Blogger and an amateur speaker </p><p> I write about Python, Django, AngularJS and sometimes something non-technical. </p><p> Welcome to my corner <i class="em em-snake"></i></p> </div><form method="get" action="https://www.google.com/search"><input name="sitesearch" value="rahmonov.me" type="hidden"><input type="text" id="search-query" class="field field-text" required name="q" placeholder="Search..." autocomplete="off"><input type="image" src="/static/images/search-icon.png" width="20" height="20" class="search-icon" title="Search via Google" alt="Search via Google"></form><ul class="menu"><li><a href="/">Home</a></li><li><a href="/pages/about.html">About</a></li><li><a href="/pages/about.html#subscribe">Subscribe</a></li><li><a href="/pages/about.html#contact">Contact</a></li><li><a href="/feeds/atom.xml">RSS <i class="fa fa-rss"></i></a></li></ul><p class="profiles"><a title="GitHub" href="https://github.com/rahmonov"><i class="fa fa-github-square"></i></a><a title="StackOverflow" href="https://stackoverflow.com/users/4137194/jahongir-rahmonov?tab=profile"><i class="fa fa-stack-overflow"></i></a><a title="Twitter" href="https://twitter.com/the_rahmonov"><i class="fa fa-twitter-square"></i></a><a title="Facebook" href="https://www.facebook.com/rahmonovj"><i class="fa fa-facebook-official"></i></a><a title="Instagram" href="https://www.instagram.com/rahmonov.me/"><i class="fa fa-instagram"></i></a><a title="LinkedIn" href="https://www.linkedin.com/in/jahongirrahmonov"><i class="fa fa-linkedin-square"></i></a></p><br><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-7110437178205620" data-ad-slot="4214071905" data-ad-format="auto"></ins><script>
              (adsbygoogle = window.adsbygoogle || []).push({});
              </script></div><div class="wrap"><div class="content"><h4>Sat 03 February 2018</h4><h1>Introduction to Kubernetes</h1><div class="entry-content"><p>Looking back, 2017 was the year Kubernetes conquered the container orchestration space. For years, Kubernetes' rivals such as Docker Swarm and Mesos have been offering their own container orchestration tools and now they both added support for Kubernetes within their ecosystems. The largest cloud providers such as AWS, Microsoft Azure and Oracle Cloud announced Kubernetes integrations into their respective cloud platforms, not mentioning Google where Kubernetes came from originally. So, every developer would benefit from at least learning the basics of Kubernetes. That's exactly what we are going to do in this post.</p><p>Before we get started I want you to watch this awesome animated guide first. Then come back and we will discuss the details:</p><iframe width="760" height="415" src="https://www.youtube.com/embed/4ht22ReBjno" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe><p>Did you watch it? NO? GO BACK TO THE VIDEO YOU STUBBORN LITTLE DEVELOPER! Good. Now let's get the formal definition of Kubernetes out of the way:</p><blockquote><p>Kubernetes is a system for managing containerized applications across a cluster of nodes</p></blockquote><p>In simple terms, you have a group of machines (e.g. VMs) and containerized applications (e.g. Dockerized applications), and Kubernetes will help you to easily manage those apps across those machines. We will see a practical example later.</p><h2>Kubernetes components</h2><p>Kubernetes cluster consists of Master and Nodes:</p><div class="gallery large"><a href="https://s3.amazonaws.com/rahmonov.me/post-images/intro-to-k8s/cluster.svg" rel="lightbox" title="Kubernetes Cluster"><img src="https://s3.amazonaws.com/rahmonov.me/post-images/intro-to-k8s/cluster.svg" alt="Kubernetes Cluster"><span>Kubernetes Cluster (https://kubernetes.io)</span></a></div><p>Master is the controlling machine and has components which operate as the main management contact point for users. Nodes are where your containerized apps run. Simply put, you run your containerized apps in nodes and you control them through the master.</p><p>Both master and nodes have very important components which we discuss below.</p><h3>Master Components</h3><ul><li><p><strong>Etcd</strong> is a consistent and highly-available key-value store used as Kubernetes’ backing store for all cluster data. Basically, it is a database for Kubernetes data and represents the state of the cluster.</p></li><li><p><strong>API Server</strong> is what exposes Kubernetes API, as its name suggests. It is the main management point of the entire cluster. It acts as the bridge between various components disseminating information and commands. In simple terms, it is the frontend of the Kubernetes control pane.</p></li><li><p><strong>Controller Manager</strong> is responsible for regulating the state of the cluster and performing routine tasks. For example, the replication controller ensures that the number of replicas defined for a service matches the number currently deployed on the cluster. Another example is the endpoints controller adjusting, well, endpoints by watching for changes in Etcd.</p></li><li><p><strong>Scheduler Service</strong> is what assigns workloads to nodes. This is how it does it:</p><ol><li>Reads the workload's operating requirements</li><li>Analyze the current infrastructure environment</li><li>Place the workload on an acceptable node(s)</li></ol></li></ul><h3>Node Components</h3><div class="gallery large"><a href="https://s3.amazonaws.com/rahmonov.me/post-images/intro-to-k8s/node.svg" rel="lightbox" title="Node components"><img src="https://s3.amazonaws.com/rahmonov.me/post-images/intro-to-k8s/node.svg" alt="Node components"><span>Node Components (https://kubernetes.io)</span></a></div><ul><li><p><strong>Docker</strong> is used in order to run your containers, duh! <code>rkt</code> can be used as an alternative to docker.</p></li><li><p><strong>Kubelet</strong> is the main contact point for each node with the cluster group, relaying to and from control pane services (master).</p></li><li><p><strong>Proxy</strong> is used for maintaning network rules and performing connection forwarding. This is what enables the Kubernetes service abstraction (DNS).</p></li></ul><p>You won't directly interact with these components directly but it is good to know what is happening behind the magic.</p><p>If the above components are something you don't have to know, the following you must know. Pay great attention.</p><h2>Kubernetes Work Units</h2><ul><li><strong>Pod</strong> is the most basic unit in Kubernetes. It represents a unit of deployment, i.e. a single instance of an application which may consist of either a single container or a small number of containers that are tightly coupled and that share resources (for example, a cloud sql proxy container should run in the same pod as the main application). Other than an application container (or multiple containers), a pod encapsulates storage resources, a unique network IP and options that govern how the container(s) should run.</li></ul><div class="gallery large"><a href="https://s3.amazonaws.com/rahmonov.me/post-images/intro-to-k8s/pods.svg" rel="lightbox" title="Pods"><img src="https://s3.amazonaws.com/rahmonov.me/post-images/intro-to-k8s/pods.svg" alt="Pods"><span>Pods (https://kubernetes.io)</span></a></div><p>Excuse the image size. You rarely have to directly deploy pods (I never have). You mostly will attach into the process for debugging and testing purposes.</p><ul><li><strong>Service</strong> groups together logical collections of pods that perform the same function and presents them as a single entity. Also, it acts as a basic load balancer between pods and enables consumers not to worry about anything beyond a single access location.</li></ul><div class="gallery large"><a href="https://s3.amazonaws.com/rahmonov.me/post-images/intro-to-k8s/service1.svg" rel="lightbox" title="Service"><img src="https://s3.amazonaws.com/rahmonov.me/post-images/intro-to-k8s/service1.svg" alt="Service"><span>Service (https://kubernetes.io)</span></a></div><ul><li><strong>Label</strong> is an arbitrary tag to mark work units. Basic key-value pairs. They are what enable services to group several pods together. Let's say you give your pods this label "microservice: auth" and the service with the same selector ("microservice: auth") will be able to forward traffic to those pods.</li></ul><div class="gallery large"><a href="https://s3.amazonaws.com/rahmonov.me/post-images/intro-to-k8s/service2.svg" rel="lightbox" title="Lables"><img src="https://s3.amazonaws.com/rahmonov.me/post-images/intro-to-k8s/service2.svg" alt="Labels"><span>Labels (https://kubernetes.io)</span></a></div><ul><li><strong>Deployment</strong> provides a declarative syntax to create/update pods. You tell a deployment your desired state (how many, how fast, when) and it changes the actual state to the desired state at a specified rate</li></ul><div class="gallery large"><a href="https://s3.amazonaws.com/rahmonov.me/post-images/intro-to-k8s/deployment2.svg" rel="lightbox" title="Deployment"><img src="https://s3.amazonaws.com/rahmonov.me/post-images/intro-to-k8s/deployment2.svg" alt="Deployment"><span>Deployment (https://kubernetes.io)</span></a></div><ul><li><p><strong>Ingress</strong> manages external access to the services. Provides load balancing, SSL termination and path/hos based routing, which are considered its advantages over services of "Load Balancer" type. See below for more details.</p></li><li><p><strong>Ingress Controller</strong> is what implements <code>Ingress</code> definitions. That is, you write what you need in <code>Ingress</code> objects and ingress controllers will turn them into reality. It means that <code>Ingress</code> itself is nothing without <code>Ingress Controllers</code>.</p></li></ul><h2>Full example</h2><p>I know that this is all theory and it is boring. You need to set these things up yourself in order to fully understand. That's why, carefully go trough this post and get your hands dirty:</p><blockquote><p><a href="/posts/nginx-ingress-controller/">Full Kubernetes Example</a> </p></blockquote><p>Did you go through the example? Pretty cool huh? Kubernetes makes everything very easy. Now that you have seen a practical example, read these common pitfalls that I have been a victim of while learning Kubernetes. They will save you weeks of your time.</p><h2>Common pitfalls</h2><ul><li><p><strong>Using services of type "LoadBalancer" to expose externally</strong>: In most tutorials, even in the official documentation, they use <code>LoadBalancer</code> services to expose the application. The reason is that it is really easy to do and great of testing. However, when you want to do SSL termination or route/host based routing, services are not your friends. Use <code>Ingress</code> for real applications.</p></li><li><p><strong>GKE Ingress Controller</strong>: In GKE, you don't have to manage your own ingress controller because GKE has its own managed for you. It is great and it works great. However, it cannot force <code>https</code> at the time of this writing. Maybe it will change in the future. But for now, you will have to manage your own Ingress Controller if <code>https</code> is a must for your app, which it should be in 2018. See the full example about on how to do that.</p></li><li><p><strong>SSL certificates</strong>: Don't manage them yourself. Use <a href="https://github.com/jetstack/kube-lego"><code>kube-lego</code></a> which automatically updates your certificates when they are about to expire.</p></li></ul><h2>Bonus</h2><ul><li><p><strong>Zero Downtime</strong>: By using something called <code>readiness-probe</code> and a rolling update strategy it is very easy to achieve zero-downtime deployment. Let me know in the comments if you want a post showing how to do this.</p></li><li><p><strong>Don't be afraid to switch to Kubernetes</strong>: Kubernetes is a new technology and is full of <strike>dark</strike> magic. That's why, it is very natural to be afraid to switch from old tools to Kubernetes, especially in production. I know I was terrified. So, what I did was to switch gradually. First step was to forward 10% of the production traffic to our Kubernetes cluster and the rest 90% to our old setup. Next step was to monitor how it was doing. If it was doing OK we changed those numbers to 30% and 70%. And on it goes until it reaches 100% to Kubernetes cluster and 0% to our old setup. This way, you can make sure that your new Kuberbetes cluster will do just fine even in production. We were using <code>NGINX</code> in our old setup and this is how we split traffic between upstreams:</p></li></ul><div class="highlight"><pre><span></span>upstream dashboard_app_server <span class="o">{</span>
    server old-setup.com <span class="nv">weight</span><span class="o">=</span>9<span class="p">;</span>
    server new-kubernetes-cluster.com <span class="nv">weight</span><span class="o">=</span>1<span class="p">;</span>
<span class="o">}</span>
</pre></div><p>It means that 90% of the traffic goes to old old-setup.com and 10% goes to new-kubernetes-cluster.com. Pretty easy.</p><h2>Conclusion</h2><p>I wish I had this material when I was learning Kubernetes. It would save me weeks of my time. I hope it saves for somebody else. Make sure to check out the <a href="/posts/nginx-ingress-controller/">full example</a>. And always remember this quote from <a href="https://twitter.com/kelseyhightower">Kelsey Hightower</a> himself:</p><blockquote><p>Kubernetes is going to set you free. But it is going to piss you off first.</p></blockquote><p>Thanks for reading.</p><p>Fight on! </p><hr><p>You may also find this <strong>related</strong> post interesting: <a href="/posts/nginx-ingress-controller/">Nginx Ingress Controller</a></p></div><div class="pagination clearfix"><a class="prev" href="/posts/python-gil/">« Previous</a><a class="next" href="/posts/zero-downtime-deployment-with-kubernetes/">Next »</a></ul></div><p><div class="likely likely-big"><div class="facebook">Share</div><div class="twitter" data-via="rahmon0v">Tweet</div><div class="telegram">Send</div><div class="linkedin">Share</div></div></p><div class="end"><span> If you liked what you read, subscribe below. Once in a while, I will send you a list of my new posts. </span><div id="popup"><p><link href="//cdn-images.mailchimp.com/embedcode/classic-10_7.css" rel="stylesheet" type="text/css"><style type="text/css">
                #mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; }
                /* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
                   We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
            </style><div id="mc_embed_signup"><form action="//rahmonov.us16.list-manage.com/subscribe/post?u=9e30bdfdfe0a7bd7cf7e0d50a&id=af3f3c5f76" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate><div id="mc_embed_signup_scroll"><div class="indicates-required"><span class="asterisk">*</span> indicates required</div><div class="mc-field-group"><label for="mce-MMERGE1">Name </label><input type="text" value name="MMERGE1" class id="mce-MMERGE1"></div><div class="mc-field-group"><label for="mce-EMAIL">Email Address <span class="asterisk">*</span></label><input type="email" value name="EMAIL" class="required email" id="mce-EMAIL"></div><div id="mce-responses" class="clear"><div class="response" id="mce-error-response" style="display:none"></div><div class="response" id="mce-success-response" style="display:none"></div></div> <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_9e30bdfdfe0a7bd7cf7e0d50a_af3f3c5f76" tabindex="-1" value></div><div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div></div></form></div></p></div></div> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-7110437178205620" data-ad-slot="4409204211" data-ad-format="auto"></ins><script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script><div id="disqus_thread"></div><script type="text/javascript">
        /* * * CONFIGURATION VARIABLES * * */
        var disqus_shortname = 'jrahmonov';

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></div></div></div><script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-67392250-1', 'auto');
      ga('send', 'pageview');
    </script><script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script><script src="/static/js/mobile.js"></script><script src="/static/vendor/lightbox2/js/lightbox.min.js"></script></body></html>